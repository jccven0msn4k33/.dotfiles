# Initialize development tools

# Python - pyenv
if [ -d "$PYENV_ROOT" ]; then
    export PATH="$PYENV_ROOT/bin:$PATH"
    eval "$(pyenv init --path)"
    eval "$(pyenv init -)"
fi

# ruby - rbenv
if [ -d "$RBENV_ROOT" ]; then
    export PATH="$RBENV_ROOT/bin:$PATH"
    # eval "$(rbenv init -)"
    eval "$(rbenv init - --no-rehash bash)"
fi

# Linuxbrew/Homebrew
if [ -x "/home/linuxbrew/.linuxbrew/bin/brew" ]; then
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
else
    echo "Warning: Homebrew is not installed or not executable at /home/linuxbrew/.linuxbrew/bin/brew" >&2
fi

# PHP - phpenv
# export PHPENV_ROOT="$HOME/.phpenv"
# if [ -d "$PHPENV_ROOT" ]; then
#   export PATH="$PHPENV_ROOT/bin:$PATH"
#   eval "$(phpenv init -)"
# fi

# NVM (Node Version Manager)
if [ -s "$NVM_DIR/nvm.sh" ]; then
    . "$NVM_DIR/nvm.sh"
fi

# SDKMAN (Software Development Kit Manager)
if [ -s "$SDKMAN_DIR/bin/sdkman-init.sh" ]; then
    source "$SDKMAN_DIR/bin/sdkman-init.sh"
fi

# Autoload Python venv if .venv exists
auto_load_venv() {
    if [ -d "$PWD/.venv" ]; then
        if [ -z "$VIRTUAL_ENV" ] || [ "$VIRTUAL_ENV" != "$PWD/.venv" ]; then
            source "$PWD/.venv/bin/activate"
        fi
    else
        if [ -n "$VIRTUAL_ENV" ]; then
            deactivate
        fi
    fi
}

# Add to PROMPT_COMMAND to run on each prompt
if [[ "$PROMPT_COMMAND" == *"auto_load_venv"* ]]; then
    : # already exists
else
    PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND;}auto_load_venv"
fi

# Run on shell initialization too
auto_load_venv

